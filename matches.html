<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>ØªÙˆÙ‚Ø¹ Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</title>
  <style>
    body { font-family: Arial, sans-serif; direction: rtl; background: #f9f9f9; }
    h2, h3 { text-align: center; }
    table { width: 95%; margin: auto; border-collapse: collapse; margin-bottom: 20px; }
    th, td { border: 1px solid #444; padding: 8px; text-align: center; }
    th { background: #007bff; color: #fff; }
    input { width: 120px; text-align: center; }
    button { padding: 6px 12px; cursor: pointer; margin: 2px; }
    .final { background: #ffeeba; }
    .add { background: #17a2b8; color: #fff; border: none; border-radius: 5px; }
  </style>
</head>
<body>
  <h2>ØªØ³Ø¬ÙŠÙ„ ØªÙˆÙ‚Ø¹Ø§Øª Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª</h2>
  <div style="text-align:center;">
    <input type="text" id="teamA" placeholder="Ø§Ù„ÙØ±ÙŠÙ‚ A">
    <input type="text" id="teamB" placeholder="Ø§Ù„ÙØ±ÙŠÙ‚ B">
    <label>â° Ù…ÙˆØ¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚:</label>
    <input type="datetime-local" id="lockTime">
    <button class="add" onclick="addMatch()">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø¨Ø§Ø±Ø§Ø©</button>
  </div>
  <h3>Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</h3>
  <table id="matchesTable">
    <tr>
      <th>Ù…</th>
      <th>Ø§Ù„ÙØ±ÙŠÙ‚ A</th>
      <th>Ø§Ù„ÙØ±ÙŠÙ‚ B</th>
      <th>Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª</th>
      <th>ØªÙˆÙ‚Ø¹ A</th>
      <th>ØªÙˆÙ‚Ø¹ B</th>
      <th>Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th>
      <th>Ø¥Ø¶Ø§ÙØ©</th>
    </tr>
  </table>
  <h3>Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</h3>
  <table id="finalResultsTable">
    <tr>
      <th>Ù…</th>
      <th>Ø§Ù„ÙØ±ÙŠÙ‚ A</th>
      <th>Ø§Ù„ÙØ±ÙŠÙ‚ B</th>
      <th>Ù†ØªÙŠØ¬Ø© A</th>
      <th>Ù†ØªÙŠØ¬Ø© B</th>
      <th>ØªØ£ÙƒÙŠØ¯</th>
    </tr>
  </table>
  <h3>Ø§Ù„ØªÙˆÙ‚Ø¹Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
  <table id="predictions">
    <tr>
      <th>Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</th>
      <th>Ø§Ù„ÙØ±ÙŠÙ‚ A</th>
      <th>Ø§Ù„ÙØ±ÙŠÙ‚ B</th>
      <th>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</th>
      <th>Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th>
      <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
      <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
    </tr>
  </table>
  <h3>ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…Ø´Ø§Ø±ÙƒÙŠÙ†</h3>
  <table id="ranking">
    <tr>
      <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
      <th>Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th>
      <th>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</th>
    </tr>
  </table>

  <script>
    let matches = [];
    let predictions = [];
    let finalResults = {};

    function addMatch() {
      let teamA = document.getElementById("teamA").value.trim();
      let teamB = document.getElementById("teamB").value.trim();
      let lockTime = document.getElementById("lockTime").value;
      if (!teamA || !teamB || !lockTime) {
        alert("Ø£Ø¯Ø®Ù„ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„ÙØ±ÙŠÙ‚ÙŠÙ† ÙˆÙ…ÙˆØ¹Ø¯ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚");
        return;
      }
      let matchId = matches.length + 1;
      matches.push({ id: matchId, teamA, teamB, lockTime: new Date(lockTime) });

      let mt = document.getElementById("matchesTable");
      let row = mt.insertRow(-1);
      row.innerHTML = `<td>${matchId}</td><td>${teamA}</td><td>${teamB}</td><td>${lockTime.replace("T"," ")}</td><td><input type="number" min="0" id="a${matchId}"></td><td><input type="number" min="0" id="b${matchId}"></td><td><input type="text" id="name${matchId}"></td><td><button type="button" onclick="addPrediction(${matchId})">âœ”</button></td>`;

      let ft = document.getElementById("finalResultsTable");
      let frow = ft.insertRow(-1);
      frow.innerHTML = `<td>${matchId}</td><td>${teamA}</td><td>${teamB}</td><td><input type="number" min="0" id="fa${matchId}" class="final"></td><td><input type="number" min="0" id="fb${matchId}" class="final"></td><td><button type="button" onclick="setFinalResult(${matchId})">âœ”</button></td>`;

      document.getElementById("teamA").value = "";
      document.getElementById("teamB").value = "";
      document.getElementById("lockTime").value = "";
    }

    function addPrediction(matchId) {
      let m = matches.find(x => x.id === matchId);
      if (new Date() > m.lockTime) { alert("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„ØªÙˆÙ‚Ø¹ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©"); return; }
      let a = document.getElementById("a" + matchId).value;
      let b = document.getElementById("b" + matchId).value;
      let name = document.getElementById("name" + matchId).value;
      if (a === "" || b === "" || name === "") { alert("Ø±Ø¬Ø§Ø¡Ù‹ Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„"); return; }
      predictions.push({ id: Date.now(), matchId, a: parseInt(a), b: parseInt(b), name, points: 0 });
      renderTables();
      document.getElementById("a" + matchId).value = "";
      document.getElementById("b" + matchId).value = "";
      document.getElementById("name" + matchId).value = "";
    }

    function setFinalResult(matchId) {
      let a = document.getElementById("fa" + matchId).value;
      let b = document.getElementById("fb" + matchId).value;
      if (a === "" || b === "") { alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙƒØ§Ù…Ù„Ø©"); return; }
      finalResults[matchId] = { a: parseInt(a), b: parseInt(b) };
      calculatePoints();
      renderTables();
    }

    function calculatePoints() {
      predictions.forEach(p => {
        p.points = 0;
        let final = finalResults[p.matchId];
        if (!final) return;
        if (p.a === final.a && p.b === final.b) { p.points = 3; } 
        else { let predictedOutcome = (p.a === p.b) ? "draw" : (p.a > p.b ? "A" : "B"); let finalOutcome = (final.a === final.b) ? "draw" : (final.a > final.b ? "A" : "B"); if (predictedOutcome === finalOutcome) p.points = 1; }
      });
    }

    function renderTables() {
      let table = document.getElementById("predictions");
      table.innerHTML = `<tr><th>Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©</th><th>Ø§Ù„ÙØ±ÙŠÙ‚ A</th><th>Ø§Ù„ÙØ±ÙŠÙ‚ B</th><th>Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©</th><th>Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th><th>Ø§Ù„Ù†Ù‚Ø§Ø·</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr>`;
      predictions.forEach(p => {
        let m = matches.find(x => x.id === p.matchId);
        let row = table.insertRow(-1);
        row.insertCell(0).innerText = p.matchId;
        row.insertCell(1).innerText = m.teamA;
        row.insertCell(2).innerText = m.teamB;
        row.insertCell(3).innerText = p.a + " - " + p.b;
        row.insertCell(4).innerText = p.name;
        row.insertCell(5).innerText = p.points;
        let actions = row.insertCell(6);
        if (new Date() < m.lockTime) { actions.innerHTML = `<button onclick="editPrediction(${p.id})">âœ</button><button onclick="deletePrediction(${p.id})">ğŸ—‘</button>`; } 
        else { actions.innerHTML = `<span style="color:#888;">Ù…ØºÙ„Ù‚</span>`; }
      });

      let ranking = {};
      predictions.forEach(p => { if (!ranking[p.name]) ranking[p.name] = 0; ranking[p.name] += p.points; });
      let sorted = Object.entries(ranking).sort((a,b) => b[1]-a[1]);
      let rankTable = document.getElementById("ranking");
      rankTable.innerHTML = `<tr><th>Ø§Ù„ØªØ±ØªÙŠØ¨</th><th>Ø§Ù„Ù…Ø´Ø§Ø±Ùƒ</th><th>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·</th></tr>`;
      sorted.forEach((r,i) => { let row = rankTable.insertRow(-1); row.insertCell(0).innerText = i+1; row.insertCell(1).innerText = r[0]; row.insertCell(2).innerText = r[1]; });
    }

    function editPrediction(id) {
      let pred = predictions.find(p => p.id===id);
      let m = matches.find(x=>x.id===pred.matchId);
      if (new Date()>m.lockTime) { alert("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©"); return; }
      let newA = prompt("ØªØ¹Ø¯ÙŠÙ„ Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ±ÙŠÙ‚ A:", pred.a);
      let newB = prompt("ØªØ¹Ø¯ÙŠÙ„ Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ±ÙŠÙ‚ B:", pred.b);
      if (newA===null||newB===null) return;
      pred.a=parseInt(newA); pred.b=parseInt(newB);
      calculatePoints(); renderTables();
    }

    function deletePrediction(id) {
      let pred = predictions.find(p=>p.id===id);
      let m = matches.find(x=>x.id===pred.matchId);
      if (new Date()>m.lockTime) { alert("Ø§Ù†ØªÙ‡Ù‰ ÙˆÙ‚Øª Ø§Ù„Ø­Ø°Ù Ù„Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø¨Ø§Ø±Ø§Ø©"); return; }
      predictions = predictions.filter(p=>p.id!==id);
      renderTables();
    }
  </script>
</body>
</html>
